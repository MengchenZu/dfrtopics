test_that("Modeling on some sample data works", {
    
    data_dir <- file.path(path.package("dfrtopics"),"dfr_data")

    # check for presence of sample data

    expect_that(file.exists(data_dir),is_true())
    expect_that(file.exists(file.path(data_dir,"citations.CSV")),is_true())
    expect_that(length(list.files(file.path(data_dir,"wordcounts"))),
                equals(665))

    # run model

    m <- model_documents(citations_files=file.path(data_dir,"citations.CSV"),
                         dirs=file.path(data_dir,"wordcounts"),
                         stoplist_file=file.path(path.package("dfrtopics"),
                                                 "stoplist","stoplist.txt"),
                         n_topics=16,
                         n_iters=200,
                         seed=42,
                         threads=2L, 
                         alpha_sum=5,beta=0.01,
                         n_hyper_iters=20,
                         n_burn_in=20,
                         n_max_iters=0) # not available in cmdline mallet

    # remembered the seed?
    expect_that(m$seed,equals(42))

    # spot-check metadata
    expect_that(nrow(m$metadata),equals(665))
    expect_that(m$metadata$title[332],equals(
        "The Empirical and the Ideal in Mark Twain\t"))

    # check instance ids against metadata ids (not in same order)
    expect_that(sort(instances_ids(m$trainer$instances)),
                equals(sort(m$metadata$id)))

    # spot-check an instance
    expect_that(instance_text(m$trainer$instances$get(427L)),equals(
'new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new new university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university university volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume volume edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited edited literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature literature book book book book book book book book book book book book book book book book book book book book book book book book book book book book book book book book book cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth cloth paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper paper literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary literary critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical critical first first first first first first first first first first first first first first first first first first first first first first first first first isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn isbn american american american american american american american american american american american american american american american american american american american american american american american american introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction introduction essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays essays work work work work work work work work work work work work work work work work work work work work work work work poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry poetry studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies studies study study study study study study study study study study study study study study study study study study study study fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction fiction modern modern modern modern modern modern modern modern modern modern modern modern modern modern modern modern modern modern available available available available available available available available available available available available available available available available available special special special special special special special special special special special special special special special special special english english english english english english english english english english english english english english english english research research research research research research research research research research research research research research research research books books books books books books books books books books books books books books books books language language language language language language language language language language language language language language language language series series series series series series series series series series series series series series series series important important important important important important important important important important important important important important important contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary contemporary century century century century century century century century century century century century century century edition edition edition edition edition edition edition edition edition edition edition edition edition edition works works works works works works works works works works works works works works german german german german german german german german german german german german german writers writers writers writers writers writers writers writers writers writers writers writers writers poets poets poets poets poets poets poets poets poets poets poets poets poets press press press press press press press press press press press press press history history history history history history history history history history history history international international international international international international international international international international international international information information information information information information information information information information information information order order order order order order order order order order order order criticism criticism criticism criticism criticism criticism criticism criticism criticism criticism criticism criticism time time time time time time time time time time time time major major major major major major major major major major major major library library library library library library library library library library library translated translated translated translated translated translated translated translated translated translated translated short short short short short short short short short short short read read read read read read read read read read read paperback paperback paperback paperback paperback paperback paperback paperback paperback paperback paperback provides provides provides provides provides provides provides provides provides provides provides literacy literacy literacy literacy literacy literacy literacy literacy literacy literacy literacy historical historical historical historical historical historical historical historical historical historical historical shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare shakespeare writing writing writing writing writing writing writing writing writing writing writing romance romance romance romance romance romance romance romance romance romance author author author author author author author author author author general general general general general general general general general general york york york york york york york york york york pages pages pages pages pages pages pages pages pages pages box box box box box box box box box box second second second second second second second second second second mla mla mla mla mla mla mla mla mla mla full full full full full full full full full full text text text text text text text text text text theory theory theory theory theory theory theory theory theory theory write write write write write write write write write write please please please please please please please please please linguistics linguistics linguistics linguistics linguistics linguistics linguistics linguistics linguistics complete complete complete complete complete complete complete complete complete anthology anthology anthology anthology anthology anthology anthology anthology anthology authors authors authors authors authors authors authors authors authors publication publication publication publication publication publication publication publication publication story story story story story story story story story offers offers offers offers offers offers offers offers offers different different different different different different different different different texts texts texts texts texts texts texts texts texts college college college college college college college college tradition tradition tradition tradition tradition tradition tradition tradition written written written written written written written written bibliography bibliography bibliography bibliography bibliography bibliography bibliography bibliography collection collection collection collection collection collection collection collection online online online online online online online online part part part part part part part part call call call call call call call call french french french french french french french french classic classic classic classic classic classic classic classic culture culture culture culture culture culture culture culture times times times times times times times times volumes volumes volumes volumes volumes volumes volumes volumes selected selected selected selected selected selected selected selected entries entries entries entries entries entries entries po po po po po po po women women women women women women women great great great great great great great composition composition composition composition composition composition composition reading reading reading reading reading reading reading halftones halftones halftones halftones halftones halftones halftones review review review review review review review cultural cultural cultural cultural cultural cultural cultural gender gender gender gender gender gender gender prices prices prices prices prices prices prices world world world world world world world variety variety variety variety variety variety variety subject subject subject subject subject subject subject included included included included included included included others others others others others others others state state state state state state state style style style style style style style comprehensive comprehensive comprehensive comprehensive comprehensive comprehensive comprehensive detailed detailed detailed detailed detailed detailed detailed canada canada canada canada canada canada canada recent recent recent recent recent recent recent way way way way way way address address address address address address explores explores explores explores explores explores narrative narrative narrative narrative narrative narrative political political political political political political account account account account account account dates dates dates dates dates dates interpretation interpretation interpretation interpretation interpretation interpretation form form form form form form send send send send send send reader reader reader reader reader reader change change change change change change guide guide guide guide guide guide reference reference reference reference reference reference teaching teaching teaching teaching teaching teaching two two two two two two social social social social social social mark mark mark mark mark mark plays plays plays plays plays plays present present present present present present renaissance renaissance renaissance renaissance renaissance renaissance rich rich rich rich rich rich including including including including including including use use use use use use theoretical theoretical theoretical theoretical theoretical theoretical editors editors editors editors editors editors thinking thinking thinking thinking thinking thinking novel novel novel novel novel novel scholarly scholarly scholarly scholarly scholarly scholarly include include include include include include philosophy philosophy philosophy philosophy philosophy philosophy scholarship scholarship scholarship scholarship scholarship scholarship ways ways ways ways ways rinehart rinehart rinehart rinehart rinehart derrida derrida derrida derrida derrida papers papers papers papers papers hall hall hall hall hall signet signet signet signet signet development development development development development interest interest interest interest interest explore explore explore explore explore white white white white white dept dept dept dept dept based based based based based representative representative representative representative representative academic academic academic academic academic used used used used used issues issues issues issues issues published published published published published sense sense sense sense sense make make make make make selection selection selection selection selection oxford oxford oxford oxford oxford indian indian indian indian indian lited lited lited lited lited process process process process process individual individual individual individual individual poetic poetic poetic poetic poetic troduction troduction troduction troduction troduction life life life life life analysis analysis analysis analysis analysis material material material material material gale gale gale gale gale december december december december december poems poems poems poems poems city city city city city november november november november november twentieth twentieth twentieth twentieth twentieth course course course course course evaluations evaluations evaluations evaluations center center center center presents presents presents presents sources sources sources sources mandelstam mandelstam mandelstam mandelstam editions editions editions editions handling handling handling handling last last last last america america america america politics politics politics politics professor professor professor professor contributors contributors contributors contributors six six six six student student student student sigmund sigmund sigmund sigmund languages languages languages languages beyond beyond beyond beyond view view view view called called called called carol carol carol carol further further further further handbook handbook handbook handbook frisch frisch frisch frisch technical technical technical technical aspects aspects aspects aspects outstanding outstanding outstanding outstanding genre genre genre genre baroque baroque baroque baroque london london london london long long long long painting painting painting painting discourse discourse discourse discourse family family family family drama drama drama drama play play play play thought thought thought thought during during during during useful useful useful useful smith smith smith smith treatment treatment treatment treatment scholars scholars scholars scholars areas areas areas areas strategies strategies strategies strategies original original original original crown crown crown crown theories theories theories theories explorations explorations explorations explorations symposium symposium symposium symposium revised revised revised revised field field field field figures figures figures figures examines examines examines examines christian christian christian christian humanities humanities humanities humanities poet poet poet poet provide provide provide provide foreign foreign foreign foreign practical practical practical practical translation translation translation translation contribution contribution contribution contribution education education education education ever ever ever ever sciences sciences sciences sciences set set set set interested interested interested interested kinnell kinnell kinnell kinnell best best best best current current current current past past past past feminist feminist feminist feminist carefully carefully carefully carefully popular popular popular popular conference conference conference conference traditional traditional traditional traditional years years years years cambridge cambridge cambridge cambridge entire entire entire entire images images images images limits limits limits medieval medieval medieval articles articles articles creation creation creation company company company leading leading leading liverpool liverpool liverpool religion religion religion survey survey survey psychoanalysis psychoanalysis psychoanalysis relatives relatives relatives context context context contents contents contents system system system money money money italian italian italian determined determined determined activity activity activity subaltern subaltern subaltern point point point fitzgerald fitzgerald fitzgerald accessible accessible accessible visa visa visa kind kind kind better better better subjects subjects subjects sylvan sylvan sylvan find find find journal journal journal critique critique critique writ writ writ shipping shipping shipping main main main appreciation appreciation appreciation fascinating fascinating fascinating age age age four four four theatre theatre theatre followed followed followed plates plates plates galway galway galway victorian victorian victorian appear appear appear uses uses uses opposition opposition opposition users users users eliot eliot eliot oklahoma oklahoma oklahoma war war war data data data tale tale tale cassettes cassettes cassettes novels novels novels project project project things things things dictionary dictionary dictionary astor astor astor notes notes notes south south south wrote wrote wrote female female female comments comments comments spoken spoken spoken makes makes makes classroom classroom classroom index index index orders orders orders demonstrates demonstrates demonstrates department department department catalog catalog catalog members members members shows shows shows linguistik linguistik linguistik teachers teachers teachers ideology ideology ideology serious serious serious men men men readers readers readers outside outside outside practice practice practice woman woman woman native native native range range range writings writings writings looking looking looking net net net questions questions questions evolution evolution evolution deutschen deutschen deutschen students students students clear clear clear period period period high high high standard standard standard topics topics topics quarterly quarterly quarterly attention attention attention tog tog tog consists consists consists relationship relationship relationship prose prose prose begin begin begin foreword foreword foreword modernism modernism modernism covering covering covering centuries centuries centuries following following following continental continental continental far far far award award award offering offering offering list list list art art art lexicography lexicography lexicography treasury treasury treasury aims aims aims zimmerman zimmerman zimmerman question question question tell tell tell editor editor editor idiot idiot idiot offer offer offer area area area definitive definitive definitive early early early close close close freud freud syntax syntax sharpe sharpe currently currently struggle struggle child child commentary commentary giorgio giorgio career career phonology phonology complex complex conveys conveys enhance enhance designed designed stone stone laufhutte laufhutte word word services services approaches approaches psychiatry psychiatry western western tells tells antebellum antebellum segre segre glossary glossary themes themes experience experience indexes indexes said said else else interests interests setting setting implications implications give give postage postage kent kent england england comedy comedy tutor tutor affinities affinities together together reasons reasons origin origin assembled assembled follows follows take take real real listing listing niversity niversity date date truth truth illus illus alike alike sophisticated sophisticated modernist modernist plume plume king king primary primary right right possible possible visions visions taking taking realistic realistic prospectus prospectus juvenile juvenile interviews interviews identifies identifies letter letter human human cities cities includes includes relationships relationships historically historically quality quality pursuit pursuit september september sample sample masters masters expected expected iy iy perspective perspective response response illustrator illustrator publications publications communication communication look look traditions traditions north north generation generation influence influence leopold leopold cooperation cooperation benet benet card card ml ml links links angeles angeles excerpts excerpts mastercard mastercard cinema cinema maior maior legal legal cesare cesare certain certain keats keats fantasy fantasy understand understand romantic romantic plus plus praise praise postmodern postmodern entry entry specify specify show show resource resource additional additional bender bender bookstores bookstores answers answers films films conflicts conflicts nebraska nebraska atwan atwan reflections reflections union union avenue avenue pym pym critically critically typical typical ripon ripon thurston thurston warburg warburg events events ur ur term term late late fourth fourth equally equally reviews reviews teacher teacher moore moore sentence sentence promise promise excellent excellent record record translatedfrom translatedfrom wide wide public public meridian meridian concept concept psychological psychological example example newest newest macneice macneice year year consistently consistently place place broad broad records records actually actually middle middle historische historische announcing announcing forces forces knepler knepler schwartz schwartz ethnicity ethnicity graduate graduate indic indic olson olson good good exemplary exemplary responses responses mnemosyne mnemosyne computer computer correct correct responsibility responsibility revolution revolution cries cries assemble assemble emerging emerging textual textual coordinator coordinator several several separately separately sardinian sardinian julien julien distinguished distinguished telling telling annual annual nightingale nightingale roots roots newly newly wolfgang wolfgang society society periods periods film film verb verb cottage cottage various various bringing bringing letters letters scientific scientific listings listings july july modes modes austen austen once once coverage coverage giancarlo giancarlo processing processing sociological sociological light light taken taken sales sales insights insights illustrated illustrated gay gay noted noted irvine irvine request request addition addition added added deutsche deutsche musa musa stories stories cosman cosman choice choice children children man man discussed discussed ages ages murphy murphy secular secular accepted accepted letterhead letterhead until until literatures literatures artists artists number number free free trier trier local local niemeyer niemeyer private private understanding understanding vast vast institute institute philologie philologie significant significant sold sold bondanella bondanella autobiographical autobiographical harvard harvard cavell cavell examination examination check check california california fts fts computational computational biblical biblical cunningham cunningham mcmichael mcmichael counter counter collaboration collaboration features features maiorino maiorino collected collected lie lie conversation conversation black black sartre sartre winters winters problems problems become become interpretations interpretations teach teach january january folkenflik folkenflik astonishing astonishing twelve twelve aid aid publishing publishing morningside morningside lot lot jons jons vision vision impressive impressive selections selections bound bound program program institutions institutions yale yale began began telex telex lives lives dietrich dietrich antiquity antiquity scholar scholar poetics poetics introductory introductory often often combines combines hi hi united united types types get get arts arts hermeneutics hermeneutics meant meant claims claims school school known known precise precise hartmut hartmut loving loving lacapra lacapra niccolo niccolo sections sections butler butler gracq gracq cultures cultures michelangelo michelangelo unknown unknown print print bonnie bonnie examining examining corsa corsa places places growing growing beginning beginning sexual sexual iioo iioo proceedings proceedings making making particular particular another another brilliant brilliant balance balance almost almost romanistischen romanistischen emphasis emphasis virginia virginia contain contain boston boston level level arabic arabic ohio ohio publishers publishers techniques techniques extensive extensive programs programs souls souls summarizes summarizes using using isolated isolated colloquium colloquium representation representation faculty faculty freshman freshman mentor mentor literatur literatur birth birth reveals reveals numerous numerous national national charge charge levin levin applicable applicable handsomely handsomely states states writer writer stratton stratton piece piece retrieval retrieval defined defined association association speak speak maintaining maintaining specific specific aleichem aleichem third third seventeenth seventeenth mystery mystery debate debate views views rubenstein rubenstein given given focus focus strong strong concise concise thorough thorough bul maupassant final adulthood difficult tokyo intricate aleksander superiority fihn cw customers unobtainable gage lite exhibiting page sussex format erinnerung common imagining unprecise ambivalence heroic aliin concerned meaning groups corporate pittsburgh integrating prize commitment ready exploring mostly mystical universite extend unobtruintroductory introductions wso struggled happen midsummer intriguing poupard red assembles extends ultimate blends federation grotesque connecticut worldj venturesome germany minutes rthorsi group becoming enlightening theatrism moss ferlinghetti beattle workstimulating jews mysticism judicious old wertsch referring newark informative tures live prince sublime leer ghettoits ms nord decade noclasriciu anthropology hazlitt historicismand kresh comparisons interpotential salinger character chanson immediate hemingway turns title invent ambitious freeman viewpoints nineteenth something rosemary kenner bard eye source erary princeton corresponding contact dictionaries orms anti file fj architecture concepts kremfr gn mcclatchy balcony philosophers titles fast linguistically beautifully venice summative bly kennedy testimonial utopia production colors class jesionowski daughters chdild develops identified allow sholom nature experiments shevrin words laughter blau reach tour exemplar dostoevski scientists continue yourr bellow broadly jarrell ihoitoglakp accompanied deadline conceptualized cummings desire astonishingly careers feaapplicable swenson differences critic analyses ranajit achievement revisions verbal guin link hundred mississippi rukeyser room uncovered generative debt half deconstructive feature uncollected constructions pursues pickerinq fict moderi greatly sacred stallybrass nominatedfor igmar principal prosasyntax normal nal readert item marginalia damrosch wilsonlinet confused satire felman archibald proposals stendhal british witter case issue gissing takes forum coll existence lens sel zeitschrift cullen recorded courtesy owe key eudora advice guidelines slovo tenth cu march apple hohyo benvenuto design quantities demands opened felt prior magnificent winfield ballads approx brienza strand picnic illustrate melodrama goethe ih oxforder deliciously alter eleven move tentative baudelaire feminism medical estranged vanity orgy cocerg nigilt powell classics intelligent pairs resources selecting conception climax printings desirable bottom apply representing keeps sullivan occasioned demanded welty tilly minimum undertakes tate councils swann expository seperately hegel attract diversity literaturgeschichte ional learned irganizing central million retaining chapters prey lilting stilprigende witi nash yeats pictures ticular spectrum boone difficulties weir copenhagen utopian delaney reexperiencing tmpasutsn tables struggles divine madness regarded ability sp moment brother decided relations ransom cdnd freidin artist adams beryl speculated pay meyer erld lli stimpson learning goncourt feathers betten furnishes clay elements expedite theorists self illuminates ormerr document hoban simpson mystic depend refer completistsa amount kinds approval marriage body editing througho columbia modernity honesty extraordinary grammars young invoice countertraditional taming effective marquez chaucer enlightened certificates throk georges veil formulate rosen empiricism drawn stimulating biograph columibia details roaring interchange decameron helping ianauniversity conducting wagoner jones wedekinds subversion elope longenbach ron kommentare master conceptually romania curricular departmentt readable sconl collect chesterton fcess aim hlumanzities behave pontheolla hamlet opposed zettersten displacement africn interesting go issacharoff delany erotic enclosed stills scope mystik shimnkin manager forbidding identification michigan terminologists statements cezanne observers devastating hardcover sessions podium summaries performance howes soviet nist plath illustration crafted museum influential reign reexamining explicit presentation inquiries invoices neglected knew didactic depicts active analyzes eastman reactions affinity barock manages rigor kiss publisher backfor importance republic epoch balanced oregonl proas prosapia cheever gk clurman salvation adults professors stein selfreferential pazni bibliographical rrbowker space pico chakravorty indispensable antoninus exceptional krieger remarriage directory zurcher changes mcnelly posthumously developments monumental dean mccartney affect wanted wallock sandburg psychoanalytic ramvage mourning established diirrenmatt encourages image assent reinvigorating recollection tjve section director just days ested numbers traces footr jersey house andi dodson gynesis characterizations shore matervhen iture agonistic too itthey pickering menu proven edibon vinci jacobus commonly experienced heading powerful ssance ybato storm readings miltont requested lifelong shed actes fiir ballard defines characterisations iconology hertz represent always iwq sophomore merod rendered resurgence dominant respected kearns coincide faced decades drawing ctrr constructive jgrt taught descriptive painters linguistique talking explanatory opening sv sive speciall derridaandafter calized klaus acting inten snodgrass nob walk affordable unfolding doren romances discount sprachstrukturen holds opposing cowley knox search color access halftone gayatri seven lived hiqh mlil deal diferme adolescent requirements carolina lanqan jeffers adolescence utopie workable thurber feasibility rading jokn ricci greater base experts sends conaway diplomas embedded editioncharles arranged discs culler wjt finke traced understood focused receive mtue affirms photography eiand sharpened tools lexicographers viewed produced meet applied kristeva appearing vasari lht updike lism bataille tension spur wortld whitman awarded victorians temptations bestselling creates kirkus voice eduion sanctifying memory blyden payable deutscher ieir periodical provincial ashbery flannery kg wittkowski basis kgjso line ode tr overviews mayer received fictions durrenmatt roems unbedeutenden tool ideal earns preferred ppers otherness levertov testicle purpose discusses civilisation competing reserve dickey knowledge curriculum witfa luce secret honiniann lexicographical pocket emotional axelrod honors got childe loss bible overview altarity ohg scledion beowulf discussions referencing roadway contains crowe accomplishment moulding winter lanham ditfr jares culpepper poe edcikion bishop personal proliferation sternberg reflect elegant stylistics ader showing shakespearean mpler shapiro psycholchapel mississauga espite aodi minds contradictions probst healing hornbeck approach cosmic portraits gianakos examinationl italyfrancesco separa start davison successful describing deutsch idiom love hegelian pearsall impeccable americat stage delivery polku keliy next wtasscf crossin freshmen theater rutgers cassette midst timed edihiotharry night anarchy involved inquirer tantalizing mathematical rr few june gramsci accomplished concerns munich disposition highly realists grow temporary industry breaking presence ts rates dramatic invaluable australian choosing weinbrot latest illusions boundaries kerrigan ons efiaon aring shichtman fully generally bulletin tracks progress kronick reverend hollander resistance edirtim correspondence submitting volkfr notice comhe hecht patchen value onld provided werke abish hoeper rest secoond dickens nhg concomitant brinnin nemerov nations huimanities cite chronological analytic baldesar eternity evant pragmatics horizons engle andacht led interviewing timeless tih minor macleish matter attempts absence vanderbilt academia kany mentator rilke freu employ starttng economic anguish handschriften ans alphabetical service expansion moliere coluniversity caught idea minority anniversary steps ten kolloquium awakens object april prove verantwortung thinkers expanded surprise bewildering sponsored standing entwicklungen southern settings suppose wilsondisct decisions saussure structural materialien neogrammarian single edinr permanently illuminating hollywood semantic biographia retrieved listed gizving chronicle communications banziger philadelphia motifs lp untold cratic bergrarn od examined security represents cor bet happened tutors soon evolved seeing technology fifth dialects lyrical whispers bogan eastan vertigo merchant commisioned tax newssheets trammels igoreve baxter perspectives islam krupnick shifting ro xviiie klomp wright meir largest belonging already wisconsin preeminent ects reports unusually phonologie sherwood begins literaturethe ftariod brochure tollfree picture sketch double fill masterpieces persuasive speei street oral orwriote lucid name osip law juxtaposing variorum coming power gallop journey death modrw ask eberhart stud projects sui divorce nims wilikc unparalleled consideration althochdeutschen lexikon lyrik stevens departments creative proposal toni documents lovednothing luedts lc empf frost sobiloff unnamable thriller really larger classical pronominal friihen diverse campus uncle totals editi departlments romanische focuses novelists end substantially acbeth butterick ironic newey grifth immensely audiences simple rhetoric ilb complemented forms genealogy took heart adjacent learn paris performances geography remarkable cards ninety nf covered jelena model manner periphrastic onald lacan delighta novelist studded inquir relevant advisers relia aveus geoff surveillance lines waugh necessary deep liteerat theter yvor chronologically belief sousa installments uiiig countee gives confront machiavelli authorial distortions outlines convenient impact wheelock appositive bibliographic hughes marketillg pindar argues viereck summers mcguane adami fundamentally kansas goethezeit credit shattering jd greatest pindaric ccroline discussion dissimilar georgen indiana examples considering background atlantic genres bergeron made staging discovery stuck mothers eighteenth viion locate hillis hilarious heroine kleiber thoughtprovoking fictional enhanced coffin previously moustaches manifestations scriptions uzu faggots borough samples medium identity concern top accomplishmentsrepeatedly weeks combining illusion tiibingen wonderful lucidity virtually prospective robinson aesthetics ciardi congress townley sequence ideas pleasure lannr ethnic germanistische pack engaged nothing individuals aids aesthetic supplement sees literate strikingly refl grundzige continuities finally trade harmon compositions crises lif shugruc three provoked auden werk moral paragraphs throuh modem emphasizing grew welcomed profession bi schleifer bonn essay lady activis held rary bennington avital exquisite reviewers cycle linal tone decharacter ibtom amerkcn winner gellrich documentation distinction sands stresses brain configurations kramer earlier renewal peer wish uncompromising commentaries contributions imagination thello leg gets jac mind ip cup queen comparing realist enlightenment caesar wilkins vran improving imaginative parallel methods chapel dollars viewpoint reads cuny relation epistemology overcome examine humor influences enjoyed structure creeley congres natu certificate runk rhetorical dominance adaptations robbins assesses arne foris shelflist sistine insignificant professional chain antitoogy quarter controversial theatrical recurring toomer propose wooster tomaso widely applies decision translator gifted modernized gustave ws neu schauer nadell linecuts socrates telephone somewhat metafiction tests santillana fiff slliman chances flower today grammar holmes pul mixture krupat sometimes figure crucial pynchon five roethke thumbnail demonstr practitioners marilynne tta rough hill neglecting ween inside shrew primarily danlex becomes bonds excluding sensitive army directions seen collections nickname readr establish claimed render visual philosopher remaining ficfon cognitive bynner ugh accusation responsible kill ginsberg ntemporary walt grade achieve lear appraisals respect rexroth mother griffith fields months garrigue iktiulre frey event meddemmen thorndike vilkicand worlds telefax sound pressures rigorous langston forest dickinson considered matters mortimer comic attachment prooftexts vigor jokhn graphs suggestions seriously shadow fifteen arnd neuzeit coat ordered abcit kemeny stael singular preface mcleod firsthand comes scond complexity charting version gauss culled multiplica principles finest biography ogden broadway rabinowitz simply struck accounts mythologies syntactic exposition scrutiny authenticity boccaccio rival friends constructed whiteside programm corrections scbor penitentiary verlag bass mcgill cotmpaoitin neuhochdeutschen imposing berkeley natural intellectual romanes control untermeyer introducing lanzen monthly country illuminate cm perceptive beatty tristram reprintings bowker east vomn parthat ches wordsworth restrictive prominence faulkner clarify semiotics iandbook oversimplification peinnsylvania gap berryman speech expiration metamorphoses eventually mullen pocahontas ideological unsparing particularly clearly aactillfin twelfth vegetarian andersen audience szulc jg distinctive aiken thompson rural proposed living type scores marxist davidson advances destroyed bean luminescent bilingual waller born according penn tears heads dinary thoroughly arthurj investigation dearborn artd redefinition unique rosentbal implicit rose terms worthwhile playful ones degree ccartney maryland ref independently pertinent restrictives add covers attitudes sexton statement manuscripts ededionwilliam writes escapist pros howells penetration zipes extent dream updates pecific chapter delmore funintriguing paperbacks autobiography notebooks boys representations jardine heilbrun murasaki influenced ori suggests phenomena transgression purloined tongues urban tempest travel stoy ials fedor throw weird maxiiimus researchers dialogues momen uniting burns northwestern outing materials multiple hayles thereby little ldir wrin timely introduced practices marketing courses macatlister ec role verification easy sl ohn hy apartheid tried transition lies song went acute rochester screen mcwatters mcquade indebted divided citations pound indians mention allows marge oeuvre think intimate referential precision apuleius korrespondenz buying advertising wild devoted devotion carver models mods spring woolf spacing argument differentiation lists tufts disseminating difference dialog electronic sensibilities connecting quest illinois khadrajayyusi fourteenth web washington hurt mode crisis splendid wb blanchot mindful shrewdness approximately cornellj edihon virgin typically realism cooper define isolation hunter kunitz need specialists heidegger unified kentucky phone salma thoughtful france busch photograph limitations sexuality ond presenting oldest remains scbimmel brook canons summary booth extraorl territories cantor pioneering workthis gunter klein ility baym draft tribes exhaustive endnotes birken nk weber chicago geographical cosdo conceptual lir oof create doubles substantial allon intended interaction participant conventions battista uk seek comparable whenever activs famous building confinement ooge fmari penal tragic dt kemper dalmatian schmitt'
    ))

    # top words in topic #1
    expect_that(paste(m$wkf$word[1:19],collapse=" "),equals(
"chicago university jr city chin washington dr south texas houston stone north chapel cuny berkeley bloomington toronto central enig"))
    expect_that(m$wkf$weight[51:70],equals(
        c(138657,48012,46723,41441,38879,32952,10729,10561,10105,9225,8445,8347,7417,5991,5707,4514,4195,3732,3656,3603)))

    # check doc_topics id column against ids
    expect_that(m$doc_topics$id,equals(instances_ids(m$trainer$instances)))

    # spot check some document-topic scores
    expect_that(as.vector(unlist(m$doc_topics[3:5,1:16])),equals(
        c(0,310,0,0,0,0,0,45,1,25,79,2023,126,57,0,13,24,1,0,0,0,0,0,0,342,709,0,0,6,0,0,194,0,12,0,0,0,0,0,410,5,0,67,147,0,0,134,0)))

    # check that file output creates all the expected files
    out_dir <- tempdir()
    if(!file.exists(out_dir)) {
        dir.create(out_dir)
    }

    out_files <- file.path(out_dir,c(
        "topic_words.csv",
        "vocab.txt",
        "params.csv",
        "keys.csv",
        "mallet_state.gz",
        "diagnostics.xml",
        "id_map.txt",
        "instances.mallet",
        "topic_scaled.csv"))

    clear_files <- function (fs) {
        for(f in fs) {
            if (file.exists(f)) {
                unlink(f)
            }
        }
    }

    clear_files(out_files)

    output_model(m,out_dir,save_instances=T,save_scaled=T)

    expect_that(all(sapply(out_files,file.exists)),is_true())

    clear_files(out_files)

    # check that output_model fills in missing keys and doc_topics

    m$wkf <- NULL
    m$doc_topics <- NULL

    output_model(m,out_dir,save_instances=T,save_scaled=T)

    expect_that(all(sapply(out_files,file.exists)),is_true())

    clear_files(out_files)
}) 
